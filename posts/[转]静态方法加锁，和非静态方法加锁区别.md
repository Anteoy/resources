---
id: 76
date: 2016-10-01 22:29:24
title: [è½¬]é™æ€æ–¹æ³•åŠ é”ï¼Œå’Œéé™æ€æ–¹æ³•åŠ é”åŒºåˆ«
categories:
    - è½¬è½½
tags:
    - é” java
---
åŸæ–‡åœ°å€ï¼š[http://greemranqq.iteye.com/blog/1974143](http://greemranqq.iteye.com/blog/1974143)

ä»Šå¤©çœ‹äº†åˆ°æœ‰æ„æ€çš„é¢˜ï¼šåœ¨é™æ€æ–¹æ³•ä¸ŠåŠ é” å’Œ éé™æ€æ–¹æ³•åŠ é” æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»è€Œå†æ¬¡å¼•å‡ºé”æœºåˆ¶çš„ä¸€äº›ç†è§£ã€‚
å…ˆçœ‹æ–¹æ³•ï¼š
 
// è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ç±»ï¼Œé‡Œé¢å…±äº«é™æ€å˜é‡ num,ç„¶åä¸€ä¸ªé™æ€ å’Œ éé™æ€æ–¹æ³•ï¼Œéƒ½åŠ ä¸Šé”
// æˆ‘ä»¬å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆæ•°æ®èƒ½äº’æ–¥å—ï¼Ÿ
 
Javaä»£ç   

```
public class Walk {  
    public static int num = 100;  
    public static Walk walk = new Walk();  
    // é™æ€  
    public synchronized static   int run(){  
            int i = 0;  
            while (i < 10) {  
                try {  
                    num --;  
                    i++;  
                    System.out.println(Thread.currentThread().getName()+":"+num);  
                    Thread.sleep(1000);  
                } catch (InterruptedException e) {  
                    e.printStackTrace();  
                }  
            }  
            return num ;  
    }  
    // éé™æ€  
    public  synchronized int  walk(){  
            int i = 0;  
            while (i < 10) {  
                try {  
                    num --;  
                    i++;  
                    System.out.println(Thread.currentThread().getName()+":"+num);  
                    Thread.sleep(1000);  
                } catch (InterruptedException e) {  
                    e.printStackTrace();  
                }  
            }  
            return num ;  
    }  
}  
```

```
// å…ˆå»ºç«‹ä¸¤ä¸ªæµ‹è¯•ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬é»˜è®¤å¾ªç¯10æ¬¡  
public class T3 implements Runnable {  
    @Override  
    public void run() {  
        Walk walk = new Walk();  
        //Walk walk = Walk.walk;  
        walk.walk();  
    }  
}  
  
public class T1 implements Runnable{  
    @Override  
    public void run() {  
        Walk walk = new Walk();  
        //Walk walk = Walk.walk;  
        // è¿™é‡Œæˆ‘ä¾ç„¶ç”¨çš„new  
        walk.run();  
    }  
}  
```

  

 
Javaä»£ç  

```
// æµ‹è¯•æ–¹æ³•  
public class Test {  
    public static void main(String[] args) {  
        Thread t1 = new  Thread(new T1());  
        Thread t3 = new  Thread(new T3());  
        ExecutorService es = Executors.newCachedThreadPool();  
        es.execute(t1);  
        es.execute(t3);  
        es.shutdown();  
    }  
}  
```

 // æµ‹è¯•æ•°æ® æˆ‘å°±ä¸å®Œå…¨åˆ—å‡ºäº†
 
pool-1-thread-1:98
pool-1-thread-2:98
pool-1-thread-2:97
pool-1-thread-1:96
.....
å¯ä»¥çœ‹å‡ºä¸¤ä¸ªçº¿ç¨‹æ²¡æœ‰äº’æ–¥ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ
OKï¼Œæˆ‘ä»¬å°†static å…³é”®å­—å»æ‰ï¼Œä»£ç æˆ‘å°±ä¸è´´äº†ï¼Œç›´æ¥çœ‹ç»“æœã€‚ã€‚
pool-1-thread-1:98
pool-1-thread-2:98
pool-1-thread-2:96
... 
ç»“æœè¿˜æ˜¯æ²¡æœ‰å‡ºç°äº’æ–¥ç°è±¡ï¼Œå› æ­¤æˆ‘ä»¬é»˜è®¤è¦å…ˆè®©ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ10æ¬¡çš„ï¼Œå‡è®¾æˆ‘ä»¬è¿™ä¸ªæ˜¯ä¹°ç¥¨ç³»ç»Ÿè¿™æ˜¯ä¸å…è®¸çš„ã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™çŠ¶å†µå‘¢ï¼Œæ–¹æ³•éƒ½åŠ ä¸Šçš„é”çš„ã€‚
 
è¿™é‡Œå…ˆå¼•ä¸€ä¸‹é”çš„ç†è§£ï¼Œç„¶åä»åå‘å‰è§£é‡Šã€‚
JAVA çš„é”æœºåˆ¶è¯´æ˜ï¼šæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªé”ï¼Œå¹¶ä¸”æ˜¯å”¯ä¸€çš„ã€‚å‡è®¾åˆ†é…çš„ä¸€ä¸ªå¯¹è±¡ç©ºé—´ï¼Œé‡Œé¢æœ‰å¤šä¸ªæ–¹æ³•ï¼Œç›¸å½“äºç©ºé—´é‡Œé¢æœ‰å¤šä¸ªå°æˆ¿é—´ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæ‰€æœ‰çš„å°æˆ¿é—´éƒ½åŠ é”ï¼Œå› ä¸ºè¿™ä¸ªå¯¹è±¡åªæœ‰ä¸€æŠŠé’¥åŒ™ï¼Œå› æ­¤åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªäººæ‰“å¼€ä¸€ä¸ªå°æˆ¿é—´ï¼Œç„¶åç”¨å®Œäº†è¿˜å›å»ï¼Œå†ç”±JVM å»åˆ†é…ä¸‹ä¸€ä¸ªè·å¾—é’¥åŒ™çš„äººã€‚
 
ç¬¬äºŒæ¬¡å®éªŒï¼Œæˆ‘ä»¬æ˜¯å¯¹æ–¹æ³•è¿›è¡ŒåŠ é”äº†ï¼Œä½†æ˜¯æ²¡å¾—åˆ°æƒ³è¦çš„ç»“æœï¼ŒåŸå› åœ¨äºæˆ¿é—´ä¸é’¥åŒ™ã€‚å› ä¸ºæˆ‘ä»¬æ¯ä¸ªçº¿ç¨‹åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™éƒ½æ˜¯new ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ä¸¤ä¸ªç©ºé—´ï¼Œä¸¤æŠŠé’¥åŒ™ï¼Œè€Œé™æ€å˜é‡åªæœ‰ä¸€ä¸ªï¼Œç›¸å½“äºæˆ‘ä»¬æœ‰ä¸¤æŠŠé’¥åŒ™ï¼Œä»ä¸åŒçš„æˆ¿é—´å¼€é—¨å–å…±äº«çš„å€¼ï¼Œå› æ­¤å‡ºé”™ã€‚
 
å¦‚æœæˆ‘ä»¬ä½¿ç”¨é™æ€å˜é‡walk å‘¢ï¼Ÿè¿™ä»£ç æ”¾å¼€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡å»æ“ä½œå˜é‡ï¼Œé‚£ä¹ˆç»“æœ..
 
ä½¿ç”¨ Walk.walk.walk();  å’Œ Walk.run();
 
ç»“æœï¼šè¿˜æ˜¯æ²¡æœ‰äº’æ–¥
pool-1-thread-1:99
pool-1-thread-2:98
pool-1-thread-1:97
...
 
å¦‚æœæˆ‘ä»¬æŠŠé™æ€æ–¹æ³•å…³é”®å­— å»æ‰: å°±å¯ä»¥çœ‹è§äº’æ–¥ç°è±¡äº†
 
pool-1-thread-1:99
pool-1-thread-1:98
pool-1-thread-1:96
 
ç»“æœå‘ç°è¿˜æ˜¯ä¼šé‡å¤ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œåœ¨é™æ€æ–¹æ³•ä¸ŠåŠ é”ï¼Œå’Œæ™®é€šæ–¹æ³•ä¸ŠåŠ é”ï¼Œä»–ä»¬ç”¨çš„ä¸æ˜¯åŒä¸€æŠŠæ‰€ï¼Œä¸æ˜¯åŒä¸€æŠŠé’¥åŒ™ã€‚ä»è€Œå¾—å‡º ä»–ä»¬çš„å¯¹è±¡é”æ˜¯ä¸åŒçš„ï¼Œå¯¹è±¡ä¹Ÿæ˜¯ä¸åŒçš„ã€‚
 
è¿™é‡Œå†æ¬¡å¼•å‡ºä¸€ä¸ªæ¦‚å¿µï¼šå¯¹è±¡é”  å’Œ  ç±»é”
 
å¯¹è±¡é”ï¼šJVM åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œé»˜è®¤ä¼šç»™æ¯ä¸ªå¯¹è±¡ä¸€æŠŠå”¯ä¸€çš„å¯¹è±¡é”ï¼Œä¸€æŠŠé’¥åŒ™
ç±»é”ï¼šæ¯ä¸€ä¸ªç±»éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰ä¸€ä¸ªå¯¹è±¡é”ã€‚
 
å‘µå‘µï¼Œæ¦‚å¿µæ„Ÿè§‰æ··æ·†äº†ï¼Œå…¶å®éƒ½æ˜¯é”ï¼Œå–ä¸¤ä¸ªåè¯ï¼Œä¸‹é¢åŒºåˆ†æ–¹ä¾¿ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬è¿™æ ·å®ç°ã€‚
 
 
Javaä»£ç  

```
// é™æ€ï¼Œè¿™é‡Œä»…ä»…å°†æ–¹æ³•æ‰€ å˜æˆäº† ç±»é”ã€‚  
    public  static int run(){  
        synchronized(Walk.class) {  
            int i = 0;  
            while (i < 10) {  
                try {  
                    num --;  
                    i++;  
                    System.out.println(Thread.currentThread().getName()+":"+num);  
                    Thread.sleep(1000);  
                } catch (InterruptedException e) {  
                    e.printStackTrace();  
                }  
            }  
            return num ;  
        }  
    }  
```

ç»“æœï¼š
pool-1-thread-1:98
pool-1-thread-2:98
pool-1-thread-2:97
pool-1-thread-1:97
...
å‘ç°ç»“æœè¿˜æ˜¯ä¸æ˜¯äº’æ–¥çš„ï¼Œè¯´æ˜åœ¨é™æ€æ–¹æ³•ä¸ŠåŠ é”ï¼Œå’Œ å®ä¾‹æ–¹æ³•åŠ é”ï¼Œå¯¹è±¡é” å…¶å®ä¸ä¸€æ ·çš„ã€‚å¦‚æœæˆ‘ä»¬æ”¹æˆï¼š
synchronized(walk) {
//....ç•¥
}
 
ç»“æœï¼š
pool-1-thread-2:99
pool-1-thread-2:98
pool-1-thread-2:97
è¿™æ ·å°±äº’æ–¥äº†ï¼Œå› ä¸ºT1 æ˜¯é€šè¿‡é™æ€å˜é‡walk è°ƒç”¨çš„ï¼Œé»˜è®¤å°±æ˜¯ç”¨çš„walk å¯¹è±¡è¿™æŠŠé”ï¼Œè€Œé™æ€æ–¹æ³• å¼ºåˆ¶è®©ä»–ä¹Ÿä½¿ç”¨ walkè¿™æŠŠé”ï¼Œå°±å‡ºç°äº†äº’æ–¥ç°è±¡ï¼Œå› ä¸ºé’¥åŒ™åªæœ‰ä¸€æŠŠã€‚
 
å¦‚æœæˆ‘ä»¬ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•å‘¢ï¼Ÿ
..
å°ç»“ï¼š
    1.å¯¹è±¡é”é’¥åŒ™åªèƒ½æœ‰ä¸€æŠŠæ‰èƒ½äº’æ–¥ï¼Œæ‰èƒ½ä¿è¯å…±äº«å˜é‡çš„å”¯ä¸€æ€§
    2.åœ¨é™æ€æ–¹æ³•ä¸Šçš„é”ï¼Œå’Œ å®ä¾‹æ–¹æ³•ä¸Šçš„é”ï¼Œé»˜è®¤ä¸æ˜¯åŒæ ·çš„ï¼Œå¦‚æœåŒæ­¥éœ€è¦åˆ¶å®šä¸¤æŠŠé”ä¸€æ ·ã€‚
    3.å…³äºåŒä¸€ä¸ªç±»çš„æ–¹æ³•ä¸Šçš„é”ï¼Œæ¥è‡ªäºè°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡ï¼Œå¦‚æœè°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆé”å¿…ç„¶ç›¸åŒï¼Œå¦åˆ™å°±ä¸ç›¸åŒã€‚æ¯”å¦‚ new A().x() å’Œ new A().x(),å¯¹è±¡ä¸åŒï¼Œé”ä¸åŒï¼Œå¦‚æœAçš„å•åˆ©çš„ï¼Œå°±èƒ½äº’æ–¥ã€‚
    4.é™æ€æ–¹æ³•åŠ é”ï¼Œèƒ½å’Œæ‰€æœ‰å…¶ä»–é™æ€æ–¹æ³•åŠ é”çš„ è¿›è¡Œäº’æ–¥
    5.é™æ€æ–¹æ³•åŠ é”ï¼Œå’Œxx.class é”æ•ˆæœä¸€æ ·ï¼Œç›´æ¥å±äºç±»çš„€æ ·ï¼Œç›´æ¥å±äºç±»çš„